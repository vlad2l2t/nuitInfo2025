<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SNAKE! // TUX contre APPLE</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Anton&family=Space+Mono:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styleSnake.css">
</head>
<body>

    <div class="crt-scanlines"></div>
    <div class="ui-vignette"></div>
    <div class="ui-noise"></div>

    <div class="grid-container">
        
        <div class="grid-item span-full header-panel">
            <div class="panel-meta">
                <span>OS: Noyau Linux 6.9</span>
                <span>Cible: Société Apple</span>
                <span>Utilisateur: Root</span>
            </div>
            <h1 class="hero-title">PROTOCOLE <span class="text-alert">snake</span></h1>
            <p class="hero-subtitle" style="font-family: 'Space Mono'; font-size: 1rem; margin-top: 1rem;">Simulation de <span class="text-alert">snake</span> Open Source</p>
        </div>

       <div class="grid-item span-full ticker-panel">
            <div class="ticker-track">
                <span class="ticker-content">
                    MISSION: CONSOMMER POMME PROPRIÉTAIRE // ÉVITER PANIC NOYAU (MURS) // NE PAS MORDRE VOTRE PROPRE QUEUE // DÉPLOIEMENT UNITÉ TUX... // CONSOMMER POMME PROPRIÉTAIRE // ÉVITER PANIC NOYAU (MURS) // UTILISER 9.9.9.9 // 
                    LES DOMINER TOUS... // f25a2fc72690b780b2a14e140ef6a9e0 // DÉPLOIEMENT UNITÉ TUX... //
                </span>
                
                <span class="ticker-content">
                    MISSION: CONSOMMER POMME PROPRIÉTAIRE // ÉVITER PANIC NOYAU (MURS) // NE PAS MORDRE VOTRE PROPRE QUEUE // DÉPLOIEMENT UNITÉ TUX... // CONSOMMER POMME PROPRIÉTAIRE // ÉVITER PANIC NOYAU (MURS) // UTILISER 9.9.9.9 // 
                    LES DOMINER TOUS... // f25a2fc72690b780b2a14e140ef6a9e0 // DÉPLOIEMENT UNITÉ TUX... //
                </span>
            </div>
        </div>

        <div class="grid-item span-double border-right content-panel" style="padding: 0;">
            <div id="game-wrapper">
                <canvas id="gameCanvas" width="600" height="400"></canvas>
                
                <div id="loading-overlay">
                    <h2 class="hero-title" style="font-size: 2rem;">INITIALISATION...</h2>
                    <p class="text-muted">Chargement des Ressources</p>
                </div>

                <div id="game-over-overlay">
                    <h2 class="hero-title text-alert" style="font-size: 3rem;">PANIC_NOYAU</h2>
                    <p>ÉCHEC !</p>
                    <button class="btn-restart" onclick="resetGame()">REDÉMARRER SYSTÈME</button>
                </div>
            </div>
        </div>

        <div class="grid-item span-single content-panel">
            <div>
                <span class="data-label">Pommes Consommées</span>
                <span class="data-value text-alert" id="score">000</span>
            </div>
            
            <div style="margin-top: 3rem;">
                <span class="data-label">Meilleur Score</span>
                <span class="data-value" id="highScore">000</span>
            </div>

            <div style="margin-top: 3rem;">
                <span class="data-label">Sortie du Terminal</span>
                <div style="font-size: 0.8rem; color: #666; font-family: 'Space Mono'; height: 100px; overflow: hidden; border-left: 2px solid #333; padding-left: 10px;" id="game-log">
                    > Démarrage du noyau...<br>
                </div>
            </div>

            <div class="controls-info">
                <p>CONTRÔLES:</p>
                <p><span class="key">↑</span> <span class="key">↓</span> <span class="key">←</span> <span class="key">→</span> pour déplacer le <br>serpent-pingouin</p>
            </div>
        </div>

        <div class="grid-item span-full footer-panel">
            <div class="footer-col">
                <small>GOONMAXXERS 2K25</small>
            </div>
            <div class="footer-col center-content">
                <a href="index.html" class="btn-footer-retro">
                    > RETOUR ACCUEIL _
                </a>
            </div>
            <div class="footer-col align-right">
                <small>PROTOCOLE SNAKE // OPEN SOURCE</small>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const scoreElement = document.getElementById('score');
        const highScoreElement = document.getElementById('highScore');
        const logElement = document.getElementById('game-log');
        const gameOverOverlay = document.getElementById('game-over-overlay');
        const loadingOverlay = document.getElementById('loading-overlay');

        const style = getComputedStyle(document.body);
        const colorSnakeBody = style.getPropertyValue('--color-text-main').trim();
        const colorFoodGlow = style.getPropertyValue('--color-accent-alert').trim();
        const colorBg = '#050505';
        const colorGrid = '#151515';

        const gridSize = 20;
        const tileCountX = canvas.width / gridSize;
        const tileCountY = canvas.height / gridSize;
        let assetsLoaded = false;
        let assetsCount = 0;
        const totalAssets = 2;

        const tuxImg = new Image();
        tuxImg.src = 'https://upload.wikimedia.org/wikipedia/commons/a/af/Tux.png';
        tuxImg.onload = assetLoaded;

        const appleImg = new Image();
        appleImg.src = 'https://upload.wikimedia.org/wikipedia/commons/thumb/3/31/Apple_logo_white.svg/170px-Apple_logo_white.svg.png';
        appleImg.onload = assetLoaded;

        function assetLoaded() {
            assetsCount++;
            if (assetsCount === totalAssets) {
                assetsLoaded = true;
                loadingOverlay.style.display = 'none';
                log("Ressources chargées. Démarrage du démon Tux.");
                resetGame();
            }
        }

        let score = 0;
        let highScore = localStorage.getItem('tuxHighScore') || 0;
        highScoreElement.innerText = highScore.toString().padStart(3, '0');

        let dx = gridSize;
        let dy = 0;
        let snake = [];
        let food = {};
        let gameRunning = false;
        let gameSpeed = 110;

        function log(msg) {
            const time = new Date().toLocaleTimeString('fr-FR', {hour12: false, hour: "numeric", minute: "numeric", second: "numeric"});
            logElement.innerHTML = `> [${time}] ${msg}<br>` + logElement.innerHTML;
        }

        function drawGame() {
            if (!assetsLoaded || !gameRunning) {
                 if(!assetsLoaded && gameRunning) setTimeout(drawGame, 100);
                 return;
            }

            const head = {x: snake[0].x + dx, y: snake[0].y + dy};

            if (head.x < 0 || head.x >= canvas.width || head.y < 0 || head.y >= canvas.height) {
                gameOver("Collision murale.");
                return;
            }
            // Collisions Soi-même
            for (let i = 0; i < snake.length; i++) {
                if (head.x === snake[i].x && head.y === snake[i].y) {
                    gameOver("Auto-cannibalisme détecté.");
                    return;
                }
            }

            snake.unshift(head);

            if (head.x === food.x && head.y === food.y) {
                score += 1;
                scoreElement.innerText = score.toString().padStart(3, '0');
                log("Pomme consommée. Logiciel propriétaire retiré.");
                generateFood();
                if(gameSpeed > 60) gameSpeed -= 2; 
            } else {
                snake.pop();
            }

            ctx.fillStyle = colorBg;
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            ctx.strokeStyle = colorGrid;
            ctx.lineWidth = 1;
            ctx.beginPath();
            for(let i=0; i<tileCountX; i++) { ctx.moveTo(i*gridSize, 0); ctx.lineTo(i*gridSize, canvas.height); }
            for(let j=0; j<tileCountY; j++) { ctx.moveTo(0, j*gridSize); ctx.lineTo(canvas.width, j*gridSize); }
            ctx.stroke();
            snake.forEach((part, index) => {
                if(index === 0) {
                    // Tux (Head)
                    ctx.drawImage(tuxImg, part.x - 2, part.y - 2, gridSize + 4, gridSize + 4);
                } else {
                    // Body
                    ctx.fillStyle = colorSnakeBody;
                    ctx.fillRect(part.x + 2, part.y + 2, gridSize - 4, gridSize - 4);
                }
            });

            // Pomme
            ctx.shadowBlur = 20;
            ctx.shadowColor = colorFoodGlow;
            ctx.drawImage(appleImg, food.x, food.y, gridSize, gridSize);
            ctx.shadowBlur = 0;

            setTimeout(drawGame, gameSpeed);
        }

        function generateFood() {
            food = {
                x: Math.floor(Math.random() * tileCountX) * gridSize,
                y: Math.floor(Math.random() * tileCountY) * gridSize
            };
            snake.forEach(part => {
                if (part.x === food.x && part.y === food.y) generateFood();
            });
        }

        function gameOver(reason) {
            gameRunning = false;
            log("PANIC NOYAU: " + reason);
            gameOverOverlay.style.display = 'block';
            if (score > highScore) {
                highScore = score;
                localStorage.setItem('tuxHighScore', highScore);
                highScoreElement.innerText = highScore.toString().padStart(3, '0');
            }
        }

        function resetGame() {
            if(!assetsLoaded) return;
            snake = [
                {x: 10 * gridSize, y: 10 * gridSize},
                {x: 9 * gridSize, y: 10 * gridSize},
                {x: 8 * gridSize, y: 10 * gridSize}
            ];
            dx = gridSize; dy = 0;
            score = 0; gameSpeed = 110;
            scoreElement.innerText = "000";
            gameOverOverlay.style.display = 'none';
            gameRunning = true;
            log("Système Redémarré. Tux prêt.");
            generateFood();
            drawGame();
        }

        document.addEventListener('keydown', changeDirection);

        function changeDirection(event) {
            const LEFT_KEY = 37; const RIGHT_KEY = 39;
            const UP_KEY = 38;   const DOWN_KEY = 40;
            const keyPressed = event.keyCode;

            if ([LEFT_KEY, RIGHT_KEY, UP_KEY, DOWN_KEY].includes(keyPressed)) {
                event.preventDefault();
            }

            if(!gameRunning) return;

            const goingUp = dy === -gridSize;
            const goingDown = dy === gridSize;
            const goingRight = dx === gridSize;
            const goingLeft = dx === -gridSize;

            if (keyPressed === LEFT_KEY && !goingRight) { dx = -gridSize; dy = 0; }
            if (keyPressed === UP_KEY && !goingDown) { dx = 0; dy = -gridSize; }
            if (keyPressed === RIGHT_KEY && !goingLeft) { dx = gridSize; dy = 0; }
            if (keyPressed === DOWN_KEY && !goingUp) { dx = 0; dy = gridSize; }
        }

        log("...");
    </script>
</body>
</html>